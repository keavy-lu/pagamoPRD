# 三、解決方案

## 功能(Key Features)&#x20;

* 管理者後台>課程設定>進階設定，加上疲勞度開關
  1. 題目設定區塊新增：
     1. \[開/關] 疲勞度降低土地傷害力：預設為關閉，若開啟，在遊戲裡一天前進土地和使用攻擊道具合計次數超過 500 次，對土地的傷害力逐步降低，直到800次（含）以後傷害力降為1，每天凌晨 05:00 次數歸零重置。
     2. 當開關開啟後，該課程用戶在遊戲地圖答題和使用攻擊道具就根據上述規則，受疲勞度影響
* 疲勞度機制
  1. 每天AM 05:00 前進次數、攻擊道具使用次數歸0，開始重新計算
  2. 當天前進次數＋攻擊道具使用次數<=500，傷害力維持不變
  3. 當天前進次數＋攻擊道具使用次數>=800，傷害力1
  4. 當天前進次數＋攻擊道具使用次數>500，但<800，傷害力加上疲勞度公式
* 疲勞度傷害力公式
  * 原來的傷害力數值D，套用下列公式（第一版閾值 500 上限值 800）
  * 疲勞度傷害力若算出小數點，四捨五入取整數
  * 若同時有「首答全對傷害力x2」先處理x2得到的數字，再進行疲勞度公式
  * 非年紀跟同一題最多答題次去之後

D=原傷害力，n為攻擊道具＋前進次數，閾值500，上限值800

調整公式：

<figure><img src="../.gitbook/assets/image (28).png" alt=""><figcaption></figcaption></figure>

附註：

目前前進次數超過500、800、1000次的人數與百分比



<figure><img src="../.gitbook/assets/截圖 2025-02-03 下午4.06.18.png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/截圖 2025-02-03 下午4.05.50.png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/截圖 2025-02-03 下午4.06.51.png" alt=""><figcaption></figcaption></figure>

* 畫面呈現
  *   遊戲對話提示

      根據玩家的寵物，選對應的寵物進行下列對話：

      * 當前進次數＋攻擊道具使用次數=閾值 501 時，地圖出現對話視窗：
        * 腳本編號128\
          128\_001\
          寵物：「頻繁的前進土地或使用攻擊道具，會產生疲勞造成對土地傷害力降低。主人你現在已經過勞，前進領土和使用攻擊道具效果會快速降低。」\
          128\_002\
          寵物：「如果你還想答題的話，建議改為訓練土地，或等到凌晨5:00疲勞度恢復後再繼續擴張領土！！」
          * 當前進次數＋攻擊道具使用次數=上限值 800
            * 腳本編號129\
              129\_001\
              寵物：「主人，你已精疲力盡了，現在不管是前進土地或使用攻擊道具對土地都只能造成 1 點傷害。」\
              129\_002\
              寵物：「建議你改為訓練或好好休息，等到凌晨5:00疲勞度恢復後再繼續擴張領土！」
          * 此對話提示觸發當下，若同時有 升級劇情、成就彈窗、升級動畫......等，皆放在這些項目之後再繼續顯示。
      * 此對話在條件達成時，當日各自僅出現一次（若答錯導致次數停留在500、800也不會重複再出現）
      * 疲勞度機制須製作答題後/攻擊道具達到閾值上限值的寵物對話邏輯，根據 `submitRoom`、`放置道具 API` 的回傳來呈現寵物對話。
      * 疲勞度對話，僅使用2024 新版答題介面才會出現（不支援舊版答題介面）


  * 更新劇情對話檔案：\
    plot\_dialog\
    檔案位置：\
    [https://boniotw-my.sharepoint.com/:x:/g/personal/bonio\_share\_bonio\_com\_tw/ERotN3yj6khNuiYUw9m7IMAB2DHSLWBKuaE8cd-mVgSyMg?e=ilm27l](https://boniotw-my.sharepoint.com/:x:/g/personal/bonio_share_bonio_com_tw/ERotN3yj6khNuiYUw9m7IMAB2DHSLWBKuaE8cd-mVgSyMg?e=ilm27l)\
    \
    更新方式可以參考更新腳本對話 [OP票](https://redmine.bonio.com.tw/issues/32664)<br>

<figure><img src="../.gitbook/assets/截圖 2025-02-17 上午10.35.42.png" alt=""><figcaption></figcaption></figure>

* 右上角常駐訊息（App常駐訊息）
  * 當前進次數＋攻擊道具使用次數超過閾值，常駐訊息：「疲勞狀態土地傷害力下降中，凌晨5:00狀態將解除」
    * 當到一天前進攻擊次數重置歸零時，狀態解除，移除常駐訊息
    *   極端情境目前不處理：\
        如果用戶在 05:00 之前已達到攻擊次數 500 次 (門閥值)，前端畫面呈現了常駐訊息，但到了 05:00 攻擊次數重置後，需要用戶「重整頁面」後，才會讓常駐訊息「消失」。這種極端案例，RD 建議可能暫時先不做處理，讓用戶自己重新整理就好。\
        主要是考量到要即時讓常駐訊息消失，有以下幾種做法，但都會增加效能負擔，或是維護成本：

        * 如果讓後端即時跟前端同步疲勞狀態，會增加不少資料庫查詢量，和網路傳輸量
        * 如果讓前端在每次答題後，都去檢查「是否有減傷」來判斷常駐訊息，會增加前端效能負擔
        * 如果讓前端用計時器在 05:00 自動讓常駐訊息消除，前端也需要多處理：用戶裝置改時間 / 機制規則做調整（重置時間點）


* 結算畫面傷害力 Tooltip
  * 新增 「疲勞度減傷：\[數值（負數）]」
  * 數值=原傷害力-疲勞度傷害力，例如原傷害力214，經疲勞度公式算出新的疲勞度傷害力為200，此處顯示：疲勞度減傷：-14



<figure><img src="../.gitbook/assets/截圖 2025-02-06 上午9.57.54.png" alt=""><figcaption></figcaption></figure>

## 用戶流程(User Flow)

* 防守方地主：
  1. 開啟PaGamO，發現部份土地被攻略佔領
  2. 立即使用防護罩或開啟假期模式保護重要土地
  3. 雖有土地損失，但一夕之間完全滅絕機率降低
* 極端攻擊方：
  1. 大量前進或使用攻擊道具後，出現提示告知已超過前進次數，建議訓練土地進行建設。
  2. 若堅持繼續前進或使用攻擊道具，發現傷害力下降。
  3. 次日可再重新正常前進土地。

## 重要邏輯(Key Logics)&#x20;

* **前進土地的判斷**\
  閾值＝500\
  上限值＝800

<figure><img src="../.gitbook/assets/截圖 2025-02-03 下午3.45.02.png" alt=""><figcaption></figcaption></figure>

* **使用攻擊道具的判斷**\
  閾值＝500\
  上限值＝800

<figure><img src="../.gitbook/assets/截圖 2025-02-03 下午3.45.17.png" alt=""><figcaption></figcaption></figure>

## 交付時程與上線計畫(Release Plan)

1. 拆解設計&開發階段的協作＆時程安排
2. 需要所有開發團隊合力評估一版，包含如何協作 & Sprint 安排&#x20;
3.  如果過程發現無法滿足既定時程，可能導致在目標日期無法上線時，考慮調整的方式有幾種

    1. 評估將工項分階段上線（範圍調整）
    2. 延期（時程增加）
    3. 投入更多資源、加班（增加成本）



| 階段     | 開始時間 | Deadline | 時程原因 | 實際上線時間 |
| ------ | ---- | -------- | ---- | ------ |
| PM完成規劃 |      |          |      |        |
| 設計     |      |          |      |        |
| 後端     |      |          |      |        |
| 前端     |      |          |      |        |
| APP    |      |          |      |        |
| 完成上線   |      |          |      |        |



## 階段狀態

❌ 本階段尚未取得共識，請勿往下一階段進行&#x20;

✅  代表負責人均對此章節內容有共識

<table><thead><tr><th width="308">階段</th><th width="280">參與者</th><th>狀態</th></tr></thead><tbody><tr><td>產品團隊解決方案共識</td><td>Alan, Jeff, Miles, Amy, Yuwen</td><td>✅ </td></tr><tr><td>產品團隊詳細規格討論</td><td>PM, 主責設計, 主責RD</td><td>❌</td></tr></tbody></table>





